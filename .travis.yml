language: c
env:
    global:
        - LUAROCKS=2.2.0
    matrix:
        - LUA=lua5.1
branches:
    only:
        - master
before_install:
    - bash .travis/setup_lua.sh
    - bash .travis/setup_gumbo.sh
install:
    - echo "$LUA $LUA_VERSION"
    - ls -lisad /usr/include/lua*
    - ls -lisa /usr/include/lua*
    - make LUA_PREFIX=/usr LUA_LIBDIR=/usr/lib/lua/$LUA_VERSION LUA_INCDIR=/usr/include LUA_VERSION=$LUA_VERSION LUA_LDLIBS=-llua
    - ldd ./gumbo/parse.so
    - ldconfig -p
script:
    - make check LUA=$(expr match "$LUA" '^\(.[a-z]*\)')
notifications:
    email:
        on_success: change
        on_failure: always
