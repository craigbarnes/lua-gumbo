language: c
env:
    global:
        - LUAROCKS=2.2.0
    matrix:
        - LUA=lua5.1
        - LUA=lua5.2
        - LUA=luajit2.0
        - LUA=luajit2.1
branches:
    only:
        - master
before_install:
    - bash .travis/setup_lua.sh
    - bash .travis/setup_gumbo.sh
install:
    - LUA_VERSION=$(expr match "$LUA" '^[a-z]*\([0-9\.]*\)$')
      make
      LUA_PREFIX=/usr
      LUA_LIBDIR=/usr/lib/lua/$LUA_VERSION
      LUA_INCDIR=/usr/include
      LUA_CFLAGS=-I/usr/include
      LUA_VERSION=$LUA_VERSION
    - make check-install
    - make dist
    - sudo 
      luarocks make 
      gumbo-0.2-1.rockspec 
      CFLAGS="-O2 -fPIC -ftest-coverage -fprofile-arcs"
      LIBFLAG="-shared --coverage"
script:
    - make check LUA=$(expr match "$LUA" '^\(.[a-z]*\)')
notifications:
    email:
        on_success: change
        on_failure: always
